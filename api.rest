###
# Ledger Admin API Tests
###

@baseUrl = https://stc.pinroj.com/api
# @baseUrl = https://stc.pinroj.com/api # Or your deployed URL
@contentType = application/json

# Placeholder for Merchant JWT Token - REPLACE THIS AFTER LOGGING IN VIA MERCHANT APP LOGIN TEST
@merchantToken = Bearer REPLACE_THIS_WITH_ACTUAL_MERCHANT_JWT_TOKEN

### Authentication (Admin)
# Login as administrator
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "email": "admin@example.com",
  "password": "password123"
}

### Administrators
# ... (your existing administrator tests) ...

### Accounts
# ... (your existing accounts tests) ...

### Public Registrations
# ... (your existing public registrations tests) ...

### Merchants (Admin Management)
# ... (your existing merchants tests) ...

### Transactions (Admin/System Level - if you have such an endpoint)
# Get all transactions (admin view)
GET {{baseUrl}}/transactions

# Get transactions filtered by account (admin view)
GET {{baseUrl}}/transactions?accountId=REPLACE_WITH_ACCOUNT_UUID

# Get transactions filtered by merchant (admin view)
GET {{baseUrl}}/transactions?merchantId=REPLACE_WITH_MERCHANT_UUID

# Create new transaction (ADMIN/SYSTEM LEVEL - if exists)
# This endpoint might have different authorization and request body than the merchant app one
# POST {{baseUrl}}/transactions
# Content-Type: {{contentType}}
# # Authorization: Bearer ADMIN_TOKEN_IF_NEEDED
#
# {
#   "amount": "100.00",
#   "type": "Debit", # Or "Credit"
#   "accountId": "REPLACE_WITH_ACCOUNT_UUID", # The account being affected
#   "merchantId": "REPLACE_WITH_MERCHANT_UUID", # If relevant for system transaction
#   "status": "Completed", # Or "Pending", "Failed"
#   "description": "System initiated transaction"
# }

# Get specific transaction (admin view)
GET {{baseUrl}}/transactions/REPLACE_WITH_TRANSACTION_UUID

# Update transaction (ADMIN/SYSTEM LEVEL - if exists)
# PATCH {{baseUrl}}/transactions/REPLACE_WITH_TRANSACTION_UUID
# Content-Type: {{contentType}}
# # Authorization: Bearer ADMIN_TOKEN_IF_NEEDED
#
# {
#   "status": "Declined",
#   "declineReason": "Manual adjustment"
# }


### Merchant App - Authentication & Registration
# Register new merchant (via merchant app flow simulation)
# Note: your /merchant-app/auth/register takes 'storeName', not 'name' as per our last update
POST {{baseUrl}}/merchant-app/auth/register
Content-Type: {{contentType}}

{
  "storeName": "Kao Test Cafe",
  "email": "kao.test.cafe@example.com",
  "password": "password123",
  "location": "123 Test Street, Bangkok",
  "category": "Cafe",
  "contactPerson": "Kao Tester",
  "contactPhoneNumber": "0800001234"
}

### Merchant App - Login
# Login as a merchant to get a token for subsequent merchant app requests
# You'll need to manually copy the 'token' from this response
# and update the @merchantToken variable above.
POST {{baseUrl}}/merchant-app/auth/login
Content-Type: {{contentType}}

{
  "email": "kao.test.cafe@example.com",
  "password": "password123"
}

# 

###
# Merchant App - Create Transaction (NEW TESTS)
# REQUIRES @merchantToken to be set with a valid JWT
###

### Create Transaction - Successful Case
# Assumes:
# - @merchantToken is valid
# - 'BENEFICIARY_DISPLAY_ID_ACTIVE_WITH_FUNDS' exists, is active, and has >= 50.75 balance
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: {{merchantToken}}

{
  "amount": 50.75,
  "beneficiaryDisplayId": "BENEFICIARY_DISPLAY_ID_ACTIVE_WITH_FUNDS",
  "description": "Payment for coffee and cake"
}

### Create Transaction - Beneficiary Not Found
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: {{merchantToken}}

{
  "amount": 10.00,
  "beneficiaryDisplayId": "NON_EXISTENT_DISPLAY_ID",
  "description": "Test non-existent beneficiary"
}

### Create Transaction - Beneficiary Not Active
# Assumes:
# - 'BENEFICIARY_DISPLAY_ID_INACTIVE' exists but its account status is not 'Active'
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: {{merchantToken}}

{
  "amount": 20.00,
  "beneficiaryDisplayId": "BENEFICIARY_DISPLAY_ID_INACTIVE",
  "description": "Test inactive beneficiary"
}

### Create Transaction - Insufficient Funds
# Assumes:
# - 'BENEFICIARY_DISPLAY_ID_LOW_FUNDS' exists, is active, but has < 100.00 balance
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: {{merchantToken}}

{
  "amount": 100.00,
  "beneficiaryDisplayId": "BENEFICIARY_DISPLAY_ID_LOW_FUNDS",
  "description": "Test insufficient funds"
}

### Create Transaction - Invalid Amount (Zero)
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: {{merchantToken}}

{
  "amount": 0,
  "beneficiaryDisplayId": "BENEFICIARY_DISPLAY_ID_ACTIVE_WITH_FUNDS",
  "description": "Test zero amount"
}

### Create Transaction - Invalid Amount (Negative)
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: {{merchantToken}}

{
  "amount": -10.00,
  "beneficiaryDisplayId": "BENEFICIARY_DISPLAY_ID_ACTIVE_WITH_FUNDS",
  "description": "Test negative amount"
}

### Create Transaction - Missing beneficiaryDisplayId
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: {{merchantToken}}

{
  "amount": 5.00,
  "description": "Test missing beneficiaryDisplayId"
  // "beneficiaryDisplayId": "" // or send empty string
}

### Create Transaction - Invalid Token (Example: expired or tampered)
POST {{baseUrl}}/merchant-app/transactions
Content-Type: {{contentType}}
Authorization: Bearer an.invalid.or.expired.token.here

{
  "amount": 15.00,
  "beneficiaryDisplayId": "BENEFICIARY_DISPLAY_ID_ACTIVE_WITH_FUNDS",
  "description": "Test invalid token"
}